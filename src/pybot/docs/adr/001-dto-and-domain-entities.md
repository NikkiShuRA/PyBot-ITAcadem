# ADR 001: Введение DTO и доменных сущностей для разделения слоёв

## Дата: 17-12-2025

## Статус: Accepted

## Контекст

Ранее проект страдал от циклических импортов, тесной связи ORM с бизнес-логикой и отсутствия валидации. Это приводило к ошибкам (e.g., MissingGreenlet) и сложностям в тестировании/расширении.

## Решение

- Ввели доменный слой (`domain/`) с Pydantic-моделями для бизнес-сущностей (e.g., UserEntity).
- Добавили DTO (`dto/`) для валидации и передачи данных между слоями.
- Сервисы теперь работают с DTO/Domain, ORM изолирован.
- Использовали forward refs и model_rebuild() для устранения циклов.

## Альтернативы

- Raw dicts: Нет валидации, хуже семантика.
- Dataclasses: Меньше фич, чем Pydantic (валидация, serialization).
- Без слоёв: Продолжить с ORM everywhere — но это ухудшит масштабируемость.

## Последствия

- Плюсы: Чистая архитектура, лёгкие тесты, валидация на границах.
- Минусы: Добавочный код (DTO/маппинг) — но окупится в долгосрочке.
- Риски: Начальный overhead в рефакторинге — минимизирован поэтапным внедрением.

## Ссылки

- [PR #13](https://github.com/NikkiShuRA/PyBot-ITAcadem/pull/13): Детали изменений.
- [Pydantic docs](https://docs.pydantic.dev/latest/): Для валидации.
